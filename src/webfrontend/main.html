<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>华融湘江银行</title>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="static/h-ui/css/H-ui.min.css">
  <link rel="stylesheet" href="static/h-ui.admin/css/H-ui.admin.css">
  <link rel="stylesheet" href="static/Hui-iconfont/1.0.8/iconfont.css">
  <link rel="stylesheet" href="static/h-ui.admin/skin/default/skin.css" id="skin">
  <link rel="stylesheet" href="static/h-ui.admin/css/style.css">
</head>
<body>
<header class="navbar-wrapper">
  <div class="navbar navbar-fixed-top">
    <div class="container-fluid cl">
      <a class="logo navbar-logo f-l mr-10 hidden-xs">华融湘江银行</a>
      <span class="logo navbar-slogan f-l mr-10 hidden-xs">v1.0</span>
      <a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs"
         href="javascript:;">&#xe667;</a>
      <nav class="nav navbar-nav">
      </nav>
      <nav id="Hui-userbar"
           class="nav navbar-nav navbar-userbar hidden-xs">
        <ul class="cl">
          <li>
            <span id="clock"></span>
          </li>
          <li>
            <span id="username"></span>
          </li>
          <li class="dropDown dropDown_hover">
            <a href="#" class="dropDown_A">
              <i class="Hui-iconfont">&#xe6d5;</i>
            </a>
            <ul class="dropDown-menu menu radius box-shadow">
              <li><a href="javascript:changePassword('修改密码','changePassword.html',400,300);">修改密码</a></li>
              <li><a href="javascript:logout();">退出</a></li>
            </ul>
          </li>

          <li id="Hui-msg">
            <a href="#" title="消息">
              <span class="badge badge-danger">7</span>
              <i class="Hui-iconfont" style="font-size:18px">&#xe68a;</i>
            </a>
          </li>

          <li id="Hui-skin" class="dropDown right dropDown_hover">
            <a href="javascript:;" class="dropDown_A" title="换肤">
              <i class="Hui-iconfont" style="font-size:18px">
                &#xe62a;
              </i>
            </a>
            <ul class="dropDown-menu menu radius box-shadow">
              <li>
                <a href="javascript:;" data-val="default" title="默认（黑色）">
                  默认（黑色）
                </a>
              </li>
              <li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
              <li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
              <li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
              <li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
              <li><a href="javascript:;" data-val="orange" title="橙色">橙色</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<aside class="Hui-aside">
  <div class="menu_dropdown bk_2">
    <!-- 动态菜单 -->

    <!--
    <dl id="menu-system">
      <dt>
        <i class="Hui-iconfont">&#xe62e;</i>&nbsp;系统管理
        <i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
      </dt>
      <dd>
        <ul>
          <li>
            <a data-href="system/setting.html" data-title="系统设置" href="javascript:void(0);">系统设置</a>
          </li>
          <li>
            <a data-href="system/dictionary.html" data-title="数据字典" href="javascript:void(0);">数据字典</a>
          </li>
          <li>
            <a data-href="system/log.html" data-title="系统日志" href="javascript:void(0);">系统日志</a>
          </li>
          <li>
            <a data-href="system/userlist.html" data-title="系统用户管理" href="javascript:void(0);">系统用户管理</a>
          </li>
        </ul>
      </dd>
    </dl>
    -->

  </div>
</aside>

<div class="dislpayArrow hidden-xs">
  <a class="pngfix" href="javascript:void(0);"
     onClick="displaynavbar(this)"></a>
</div>

<section class="Hui-article-box">
  <div id="Hui-tabNav" class="Hui-tabNav hidden-xs">
    <div class="Hui-tabNav-wp">
      <ul id="min_title_list" class="acrossTab cl">
        <li class="active">
          <span title="我的桌面" data-href="#">我的桌面</span>
          <em></em>
        </li>
      </ul>
    </div>
    <div class="Hui-tabNav-more btn-group">
      <a id="js-tabNav-prev" class="btn radius btn-default size-S" href="javascript:;">
        <i class="Hui-iconfont">&#xe6d4;</i>
      </a>
      <a id="js-tabNav-next" class="btn radius btn-default size-S" href="javascript:;">
        <i class="Hui-iconfont">&#xe6d7;</i>
      </a>
    </div>
  </div>

  <div id="iframe_box" class="Hui-article">
    <div class="show_iframe">
      <div style="display:none" class="loading"></div>
      <iframe scrolling="yes" frameborder="0" src="images/logo.gif"></iframe>
    </div>
  </div>
</section>

<div class="contextMenu" id="Huiadminmenu">
  <ul>
    <li id="closethis">关闭当前</li>
    <li id="closeall">关闭全部</li>
  </ul>
</div>

<script src="js/jquery-3.3.1.min.js"></script>
<script src="static/h-ui/js/H-ui.min.js"></script>
<script src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script src="static/layer/2.4/layer.js"></script>
<script src="js/jquery.contextmenu.r2.js"></script>
<script src="js/clock.js"></script>
<script src="js/bank.js"></script>
<script>
  var clock = new Clock();
  clock.display(document.getElementById("clock"));

  $(window).on('load', () => {
    // 加载当前用户信息
    $.ajax({
      url: BANK_URL + 'user',
      type: 'GET',
      contentType: 'application/json; charset=utf-8',
      dataType: 'json',
      headers: createAuthorizationTokenHeader(),
      success: function (user, textStatus, jqXHR) {
        if (user) {
          $("#username").html(user.username)
        } else {
          location.href = 'index.html'
        }
      },
      error: function (jqXHR, textStatus, errorThrows) {
        console.log('Spring Exception!')
        layer.alert('非授权用户,请先登录!', () => {
          location.href = 'index.html'
        })
      }
    })

    // start 加载动态菜单
    $.ajax({
      url: BANK_URL + 'menu_index',
      type: 'get',
      contentType: 'application/json; charset=utf-8',
      dataType: 'json',
      headers: createAuthorizationTokenHeader(),
      success: function (data) {
        // 顶层菜单
        console.log(data)
        let text = ``
        data.forEach(item => {
          // 子菜单
          let childText = ``
          item.childMenus.forEach(menu => {
            childText += `
            <li>
              <a data-href="${menu.linkUrl}" data-title="${menu.name}" href="javascript:void(0);">${menu.name}</a>
            </li>
            `
          })

          // 父菜单
          text += `
          <dl id="${item.topMenu.name}">
            <dt>
              <i class="Hui-iconfont">&#xe72b;</i>&nbsp;${item.topMenu.name}
              <i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
            </dt>
            <dd>
              <ul>${childText}</ul>
            </dd>
          </dl>
          `
        })
        $('.menu_dropdown').append(text);

        // 回调函数
        $('.Hui-aside').Huifold({
          titCell: '.menu_dropdown dl dt',
          mainCell: '.menu_dropdown dl dd'
        })
      }
    })
    // end 加载动态菜单
  })

  /**
   * 修改密码
   */
  function changePassword(title, url, w, h) {
    layer_show(title, url, w, h)
  }

  /**
   * 注销 | 退出
   */
  function logout() {
    layer.confirm("是否确认退出?", () => {
      removeJwtToken()
      location.href = "index.html"
    })
  }
</script>
</body>
</html>